
## 编译原理第二阶段报告 ##
### 一、任务 ###

**组内我们进行了新的分组，我和一个同学共同负责词法分析及中间代码生成，同时，我们全员参与文法的设计与修改。上次结束了词法分析器的设计及实现(后面也进行了一些添加，比如一些新的关键字，界符等)。我在当前阶段完成的内容为:**

1. 将部分文法改写成翻译文法;
2. 设计部分文法的递归下降子程序，在子程序中按照翻译文法，插入相应的动作/操作；
3. 与另一个同学一起搭建了中间语言这块的代码框架。
4. 完成了我所负责部分的代码，但还未进行测试。
## 二、具体实现
**中间语言大致参考、结合上课所学到的内容及PPT上的内容。整体需要做的事情粗略分为一下几个部分：**

1. 类似语法分析，选择四种方法中的一种；
2. 改写文法为翻译文法，然后利用上面选的方法，在其中加入改写文法后添加的有语义动作，完成生成四元式、查填符号表。 

**完成内容详细描写**

1. 首先在组内(四人组)讨论中间语言这块选择的要选择的语法分析部分的方法，一致决定选用递归下降子程序法；
2.我们两人一起商讨设计了四元式的结构，和代码整体框架设计； 
3. 我们两个人将文法进行了划分(我负责有赋值语句，读语句、写语句、返回语句相关文法，函数定义、调用部分相关文法)，然后各自修改自己需要完成的部分(改写文法)； 
4. 根据修改后的文法，重新设计子程序，在翻译文法中指明的位置添加相应的动作(查询、填写符号表，生成四元式等)。
5. 截止到该报告提交阶段，完成了各自翻译文法的递归子程序代码实现，但是还没有进行整合、调试。

## 三、所遇问题及部分解决方案

问题一：四元式样式设计问题。四元式一共有四项，其中最后三项可能的类型有：整型，浮点型，字符(串)型，原定使用联合体解决，但是在经过尝试后发现使用起来有诸多的限制，所以只好用结构体(损耗了大部分的存储空间)，解决了这个问题。

问题二：本来语法分析是生成了一颗颗语法树，然后用该语法树进行中间语言生成的，但是由于技术、时间等，我们两人决定对树进行一个预处理，让他变成数组型，方便了我们后续的处理(也是浪费了一定的存储空间)。

问题三：有关四元式的生成，对于书上没有的四元式(比如变量定义语句，函数定义语句等)，原本以为是也要生成四元式的，但在老师的讲解，了解到要根据它的作用来分析是否需要生成四元式(比如前面提到的，只需要查询、填写符号表即可)，然后分析设计了一部分可能用到的四元式样式。

问题四：有关调用函数之后进行跳转的部分，遇到这样函数调用的语句，因为知识还有些许的模糊，所以只是单纯的生成了跳转四元式，至于细节(比如返回值等)，目前为止没有进行更加详细的操作，会利用后面的时间和组员或者指导老师、学长学姐进行分析，询问的。

## 四、感想
由于是第一次利用代码实现中间语言生成(之前学到的都是纸上的内容，在编译的实验课上，也只写了词法分析和语法分析)，还是有较多和预想不一样的状况发生。比如书上没有提及的一些语句的四元式设计，这个需要我们自己去根据文法所要表达的信息进行分析、设计。还有翻译文法的书写和实现，对于书上有的，要结合我们选的文法进行一定程度的修改，对于书上没有的，一开始确实有点慌张、不知所措，后来在老师、学长学姐的指导下，和组员一起探讨之后得到好的解决方案。这是一个很好的锻炼过程，虽然在团队中会有摩擦，但是确实从他人的身上获得了更好的想法。

---
备注：上述提及的中间语言生成代码由于在报告提交阶段还没有测试完，所以还未提交，在进行测试之后，会及时进行提交。
