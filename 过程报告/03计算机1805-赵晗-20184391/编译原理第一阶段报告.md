## 编译原理第一阶段报告
### 一、 任务
* 组内我们进行了新的分组，我和一个同学共同负责词法分析及中间代码生成，同时，我们全员参与文法的设计与修改。当前已经完成词法分析器(合作完成，代码已经写好，并且上传了)，文法也基本完善好了，后期添加功能时可能会再有所更改。我在当前阶段所完成的内容为：

1. 文法部分设计、修改；
2. 分类码部分设计；
3. 词法分析器整体设计，修改(包括token序列数据类型，识别器，算数常数识别器等)；
4. 词法分析器设计完成后的部分功能的具体实现(识别器函数，产生类别码函数，生成token序列函数，主体处理数据函数)。

### 二、具体实现
* ##### 词法分析器的大致参考上课所学到的内容。整体粗略分为一下几个部分：
 1. 识别器(包括算数常数识别器)；
 2. 产生类别码；
 3. 查询、填写表；
 4. 生成token序列。

*  ##### 详细叙述
 1. 其中，识别器用自动机实现，其设计大致参考书上的教学内容，相当于在其基础上进行填充。(对于识别器的自动机我进行了设计与实现，对于算数常数识别器的自动机，我只进行了的设计，代码实现由另一个同学进行完成)。
2. 产生类别码是利用对终止状态的前一个状态的分析，从而获得不同数据的类别码(对这部分我进行了设计与实现)。
3. 分析中，就包含了查询、填写表的过程，一共设计了张表：关键字表，界符表，标识符表，常数表(整型、浮点型分开了)，字符表，字符串表(代码实现由另一位同学实现)。
4. 首先大致说一下token的数据结构，采用结构体，结构体中包含两部分：分类码，位置。其中，位置是在不同表中的下标。利用前面处理得到的分类码、下标信息放入token序列表中。(该部分由我设计与实现)。
### 三、所遇问题及部分解决方案
* ##### 已解决的问题
1. 首先是token的数据类型设计，原本是想采用结构体：分类码+指针的样式，但考虑到不同数据对应的指针类型不一样，经查找相关资料，若是使用指针用union类型，使用中容易出错。在参考示例代码后，决定采用上面提到的数据类型。
2. 在词法分析器整体框架的设计中，关于算数常量识别器的位置，也是犹豫了很久。本来想直接与识别器自动机进行合并，但是这样处理并不是很方便(对于我当时已经设计好的框架而言)，后面将其拆分出去。于此同时，在识别器自动机中也加入了一些状态，将常数数据进行预处理(提前大致划分好类型：整型、浮点型)，后面再在为获得类别码、位置信息之前，送入常数处理机进行进一步的处理。
3. (这个问题算是我之前在实验中遇到的)我们暂定源代码是在文件中，从文件中取出进行处理(我在文件操作这里不太熟悉)，由于无法从文件中挨个获得字符，经过不断的尝试，最后决定从文件中将数据全部获得，再挨个处理。
* ##### 待解决的问题(暂时未考虑解决方案)
1. 在自动机处理数据阶段遇到的源程序文法上的错误，对该错误进行的处理。在这里，由于还没有对错误处理进行设计，所以在代码中只是对可能出错的地方进行了注释，后期在设计好有关错误处理方面的框架后，再进行添加。
2. 常数处理机的设计中，无论是整型，单精度浮点型(将科学技术法的数据存为单精度浮点型)，存在超出数据范围的风险，目前只是考虑在范围内的数据，这块没有进行具体的设计分析，可能在之后会有解决方案(或者直接忽略这种情况，单方面认为数据大小在范围内)。
### 四、感想
* 首先，虽然在之前的实验中写过词法分析器，但由于当时在写的时候用时较少，加上知识理解不到位，所以当时的完成度不高，在此次课设中，又重新细致的学习了这部分的内容，使得设计、代码都成熟了不少，完成度比之前的好。

* 其次是在合作方面。之前实验是个人完成，有些问题，想法等，找不到人进行讨论。这次的合作确实使得设计等更加顺利。

  ---

  备注：有关分类码表、自动机样式、词法分析流程图等内容之后会进行上传。在此不进行添加。